## 内存

### 内存定义

- **硬件角度**：内存是计算机必不可少的一个组成部分（在现实生活中所存在的，比如内存条），是与CPU沟通的桥梁，计算机中所有的程序都是运行在内存中的。
- **逻辑角度**：内存是一块具备随时访问能力，支持读、写操作，用来存放程序及程序运行中产生的数据的区域。

> 现实举例：
>
> 把建筑物当成内存，计算机每一个内存都对应一个房间，整个内存条就对应一幢大楼；内存中每一个单元格地址就对应着每个房间的门牌号；内存中储存内容就是住在房间里的人。
>
> 我们可以根据内存的单元格地址获取内容，好比房间的门牌号，可以找到房间里的人。

### 内存概念

- 内存单位
- 内存编制
- 内存地址
- 内存组成
- 基础函数

#### 内存单位

内存单位类型

* 位：（bit）是电子计算机中最小的数据单位。每一位的状态只能是0或1
* 字节：1 Byte = 8 bit，是内存基本的计量单位
* KB：1 KB = 1024 Byte。也就是1024个字节
* MB：1 MB = 1024 KB。类似的还有GB，TB

内存单位是衡量内存大小的单位。

#### 内存编址

计算机中的内存按字节编址，每个地址的存储单元可以存放一个字节（8个bit）的数据，CPU通过内存地址获取指令和数据，并不关心这个地址所代表的空间具体在什么位置、怎么分布，因为硬件的设计保证一个地址对应着一个固定的空间，所以说：内存地址和地址指向的空间共同构成了一个内存单元。

>  比如一个房间中有很多地板砖，每一块地板砖的大小是固定的 64*64 ，那么内存编址的大小就是一个字节（8位），每一个内存编址中存放的大小也是固定的。

#### 内存地址

内存地址通常用十六进制的数据表示，指向内存中某一块区域。好比于房间的门牌号。

**内存地址分配规则**：内存分配规则是连续的，一个挨着一个。

当对象需要申请内存时，先给这个对象分配一个编码，这个编码就是内存地址。

#### 内存对象

每个房间住的人就是内存对象，人有不同职业表示内存对象类型。

各个房间可以住着不同的人，指针指向的内存区域能存储不同的类型。

类型：

* int（4字节）
* short（2字节）
* long（4字节）
* char（1字节）
* double（8字节）
* Long double（10字节）
* 引用类型

> 设计思路：long类型为什么只有4个字节
>
> long和int在早期16位电脑时候，int 2字节， long 4字节，而计算机发展到现在，一般32、64下，long和int一样。而java的long是8字节。

#### 内存组成

##### Android内存组成

![](D:\Study\C++基础\images\android_ram.jpg)

Android一个app在虚拟机进行加载，虚拟机会给它分配：方法去、堆内存、java栈、PC寄存器、本地方法栈。

##### C语言内存组成

![](D:\Study\C++基础\images\c_ram.jpg)

1. 堆、栈这两个内存中的概念和java的是一样的。比如我们一个app在运行的时候，java方法的执行就在java栈中；当一个对象被实例化的时候，这个内存就存放在堆区。
2. 最大的区别在于java执行，它的内存分配是基于Android虚拟机；而C语言的执行，不依懒于任何虚拟机，是直接转换为汇编语言，通过CPU来执行。
3. 这也就是C语言内存组成更简单，但同时也是更死板，它里面涵盖过多的由编译时分配的内存空间，也就是：BSS段、数据段、代码段。这些在java的内存模型中是没有的，因为在java的内存模型中，虚拟机将这三个在动态的时候进行分配。
4. BSS段、数据段、代码段这三个的出现是因为没有虚拟机的支撑，在编译时就需要做大量的工作，将一个 .c 文件执行成可执行文件之前需要编译，编译就会产生固定的内存大小、固定的数据、固定的代码段，那么就分别存在这三个区域。
5. BSS段存放全局的成员变量，这些成员变量在编译的时候无法确定它的大小，也无法确定它的内存地址。
6. 数据段存放一条数据。
7. 代码段是把函数转换成汇编语言，汇编语言由指令组成，这些指令就存放在代码段中。